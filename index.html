<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>預約系統</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      padding: 2rem;
      text-align: center;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 1.5rem;
    }
    .step {
      display: none;
    }
    .active {
      display: block;
    }
    .options {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .option {
      border: 2px solid #999;
      padding: 1rem 2rem;
      border-radius: 20px;
      cursor: pointer;
      background-color: white;
      transition: all 0.2s;
    }
    .option.selected {
      border-color: #007bff;
      background-color: #e0f0ff;
    }
    .option.disabled {
      border-color: #ccc;
      background-color: #eee;
      color: #888;
      cursor: not-allowed;
    }
    button {
      margin-top: 2rem;
      padding: 0.5rem 1rem;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    .timeslot {
      display: inline-block;
      margin: 0.5rem;
      padding: 0.8rem 1.5rem;
      border-radius: 20px;
      border: 2px solid #ccc;
      background-color: white;
      cursor: pointer;
    }
    .timeslot.selected {
      border-color: #28a745;
      background-color: #d4edda;
    }
    .timeslot.disabled {
      border-color: #ccc;
      background-color: #eee;
      color: #888;
      cursor: not-allowed;
    }
    input[type="date"] {
      padding: 0.5rem;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="step step-1 active">
    <h1>請選擇預約項目</h1>
    <div class="options">
      <div class="option" data-value="物理">物理</div>
      <div class="option" data-value="健身">健身</div>
      <div class="option" data-value="優氧">優氧</div>
    </div>
    <button id="nextBtn1" disabled>下一步：選擇日期</button>
  </div>

  <div class="step step-2">
    <h1>請選擇日期</h1>
    <input type="date" id="datePicker" min="">
    <div>
      <button id="prevBtn1">返回</button>
      <button id="nextBtn2" disabled>下一步：選擇時間</button>
    </div>
  </div>

  <div class="step step-3">
    <h1>請選擇預約時間</h1>
    <div id="timeslotContainer"></div>
    <div>
      <button id="prevBtn2">返回</button>
      <button id="nextBtn3" disabled>下一步：送出預約</button>
    </div>
  </div>

  <div class="step step-4">
    <h1>預約完成 ✅</h1>
    <p>您已成功送出預約，請稍候 LINE 通知。</p>
  </div>

  <script>
    const options = document.querySelectorAll(".option");
    const nextBtn1 = document.getElementById("nextBtn1");
    const nextBtn2 = document.getElementById("nextBtn2");
    const nextBtn3 = document.getElementById("nextBtn3");
    const prevBtn1 = document.getElementById("prevBtn1");
    const prevBtn2 = document.getElementById("prevBtn2");
    const step1 = document.querySelector(".step-1");
    const step2 = document.querySelector(".step-2");
    const step3 = document.querySelector(".step-3");
    const step4 = document.querySelector(".step-4");
    const timeslotContainer = document.getElementById("timeslotContainer");
    const datePicker = document.getElementById("datePicker");

    let selectedOptions = [];
    let selectedDate = "";
    let selectedTime = "";

    // 限制日期選擇範圍：今天+7天 到 半年內
    const today = new Date();
    const minDate = new Date(today);
    minDate.setDate(minDate.getDate() + 7);
    const maxDate = new Date(today);
    maxDate.setMonth(maxDate.getMonth() + 6);
    datePicker.min = minDate.toISOString().split("T")[0];
    datePicker.max = maxDate.toISOString().split("T")[0];

    // 選擇項目
    options.forEach(option => {
      option.addEventListener("click", () => {
        option.classList.toggle("selected");
        const value = option.dataset.value;
        if (selectedOptions.includes(value)) {
          selectedOptions = selectedOptions.filter(v => v !== value);
        } else {
          selectedOptions.push(value);
        }
        nextBtn1.disabled = selectedOptions.length === 0;
      });
    });

    // 下一步到日期
    nextBtn1.addEventListener("click", () => {
      step1.classList.remove("active");
      step2.classList.add("active");
    });

    // 返回到項目
    prevBtn1.addEventListener("click", () => {
      step2.classList.remove("active");
      step1.classList.add("active");
    });

    // 下一步到時間
    nextBtn2.addEventListener("click", () => {
      selectedDate = datePicker.value;
      step2.classList.remove("active");
      step3.classList.add("active");
      generateTimeslots();
    });

    // 返回到日期
    prevBtn2.addEventListener("click", () => {
      step3.classList.remove("active");
      step2.classList.add("active");
    });

    // 日期選擇事件
    datePicker.addEventListener("change", () => {
      nextBtn2.disabled = !datePicker.value;
    });

    // 產生時間選項
    function generateTimeslots() {
      timeslotContainer.innerHTML = "";
      const startHour = 9;
      const endHour = 22;
      for (let h = startHour; h < endHour; h++) {
        const time = `${h.toString().padStart(2, '0')}:00~${(h+1).toString().padStart(2, '0')}:00`;
        const div = document.createElement("div");
        div.classList.add("timeslot");
        div.innerText = time;
        div.dataset.time = time;

        // 模擬已滿額
        if (Math.random() < 0.3) {
          div.classList.add("disabled");
          div.onclick = null;
        } else {
          div.onclick = () => {
            document.querySelectorAll(".timeslot").forEach(el => el.classList.remove("selected"));
            div.classList.add("selected");
            selectedTime = time;
            nextBtn3.disabled = false;
          };
        }
        timeslotContainer.appendChild(div);
      }
    }

    // 送出預約
    nextBtn3.addEventListener("click", () => {
      const payload = {
        services: selectedOptions,
        date: selectedDate,
        time: selectedTime,
      };
      fetch("https://script.google.com/macros/s/AKfycbxvoR6NlUgP28lNZne3y8QWdRE2HaljG1LfMTROaqrIq7F99lfIGeZHkb5LcdRxuJtFYA/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      }).then(() => {
        step3.classList.remove("active");
        step4.classList.add("active");
      });
    });
  </script>
</body>
</html>
